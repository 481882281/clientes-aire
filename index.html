<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Clientes Aire</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f2f2f2;padding:15px;margin:0}
h1{text-align:center;font-size:22px;margin-bottom:10px}
.box{background:white;padding:15px;border-radius:14px;max-width:520px;margin:auto;box-shadow:0 4px 10px rgba(0,0,0,.08)}
input,textarea,button{width:100%;padding:14px;margin-top:10px;font-size:16px;border-radius:10px;border:1px solid #ccc}
textarea{min-height:90px}
button{border:none;font-weight:bold}
button:active{opacity:.85}
#buscar{background:#fafafa}
ul{list-style:none;padding:0;margin:0}
li{background:#f0f0f0;padding:14px;margin-top:14px;border-radius:14px;font-size:15px;line-height:1.4}
.actions{display:flex;gap:10px;margin-top:12px}
.edit{background:#007bff;color:white}
.del{background:#e53935;color:white}
@media (max-width:480px){h1{font-size:20px}input,textarea,button{font-size:17px}li{font-size:16px}}
</style>
</head>
<body>

<h1>Clientes ‚Äì Aire Acondicionado</h1>

<div class="box" id="login">
<input type="password" id="pin" placeholder="PIN">
<button onclick="entrar()">Entrar</button>
</div>

<div class="box" id="app" style="display:none">
<input id="buscar" placeholder="üîç Buscar cliente..." oninput="cargar()">

<input id="nombre" placeholder="Nombre y apellido">
<input id="ubicacion" placeholder="Ubicaci√≥n">
<input id="equipo" placeholder="Marca y modelo">
<input id="telefono" placeholder="Tel√©fono">
<input type="date" id="fecha">
<textarea id="obs" placeholder="Observaciones"></textarea>

<button onclick="guardar()">Guardar cliente</button>

<ul id="lista"></ul>
</div>

<script>
const PIN="1234";
const SHEETDB_URL = "AKfycbwtGs-2y_T4z6Ifm2AqwXrjjAN9CwUb5t65dVewhTAyt53fcp6C_m2sWTJ-ZsegBrVN";
let editIndex = null;

function entrar(){
 if(document.getElementById("pin").value===PIN){
  document.getElementById("login").style.display="none";
  document.getElementById("app").style.display="block";
  cargar();
 } else alert("PIN incorrecto");
}

function guardar(){
 let cliente = {
  nombre: document.getElementById("nombre").value,
  ubicacion: document.getElementById("ubicacion").value,
  equipo: document.getElementById("equipo").value,
  telefono: document.getElementById("telefono").value,
  fecha: document.getElementById("fecha").value,
  obs: document.getElementById("obs").value
 };

 fetch(SHEETDB_URL)
   .then(res => res.json())
   .then(arr => {
     if(editIndex!==null){
       // Editamos usando el √≠ndice
       const id = arr[editIndex]._row;
       fetch(`${SHEETDB_URL}/${id}`, {
         method:'PUT',
         headers:{'Content-Type':'application/json'},
         body:JSON.stringify({data:cliente})
       }).then(()=> {editIndex=null; limpiar(); cargar();});
     } else {
       // Nuevo cliente
       fetch(SHEETDB_URL,{
         method:'POST',
         headers:{'Content-Type':'application/json'},
         body:JSON.stringify({data:cliente})
       }).then(()=>{limpiar(); cargar();});
     }
   });
}

function editar(index){
 fetch(SHEETDB_URL)
   .then(res=>res.json())
   .then(arr=>{
     const c = arr[index];
     document.getElementById("nombre").value = c.nombre;
     document.getElementById("ubicacion").value = c.ubicacion;
     document.getElementById("equipo").value = c.equipo;
     document.getElementById("telefono").value = c.telefono;
     document.getElementById("fecha").value = c.fecha;
     document.getElementById("obs").value = c.obs;
     editIndex = index;
     window.scrollTo({top:0,behavior:"smooth"});
   });
}

function borrar(index){
 fetch(SHEETDB_URL)
   .then(res=>res.json())
   .then(arr=>{
     const id = arr[index]._row;
     if(confirm("¬øBorrar este cliente?")){
       fetch(`${SHEETDB_URL}/${id}`,{method:'DELETE'}).then(()=>cargar());
     }
   });
}

function cargar(){
 document.getElementById("lista").innerHTML="";
 fetch(SHEETDB_URL)
   .then(res=>res.json())
   .then(arr=>{
     const filtro = document.getElementById("buscar").value.toLowerCase();
     arr.forEach((c,i)=>{
       let texto=(c.nombre+" "+c.ubicacion+" "+c.equipo+" "+c.telefono).toLowerCase();
       if(!texto.includes(filtro)) return;
       document.getElementById("lista").innerHTML += `
       <li>
         <b>${c.nombre}</b><br>
         üìç ${c.ubicacion}<br>
         ‚ùÑÔ∏è ${c.equipo}<br>
         üìû ${c.telefono}<br>
         üìÖ ${c.fecha || "‚Äî"}<br>
         üìù ${c.obs || ""}
         <div class="actions">
           <button class="edit" onclick="editar(${i})">Editar</button>
           <button class="del" onclick="borrar(${i})">Borrar</button>
         </div>
       </li>`;
     });
   });
}

function limpiar(){
 document.getElementById("nombre").value="";
 document.getElementById("ubicacion").value="";
 document.getElementById("equipo").value="";
 document.getElementById("telefono").value="";
 document.getElementById("fecha").value="";
 document.getElementById("obs").value="";
 editIndex=null;
}
</script>

</body>
</html>

